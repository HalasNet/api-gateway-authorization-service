<html>
<head>
    <title>Change password</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
</head>
<body>
<div class="col-md-8 hidden-sm hidden-xs" style="padding-left: 0; padding-right: 0">
    <img style="width:100%;height:100%; background-color: #5bc0de"
         src='data:image/png;base64,#include("skyscraper.base64")'>
</div>
<div class="col-md-4" style="padding-left: 0; padding-right: 0">
    <div id="alert" style="top: 15px; left: 15px; right: 15px; position: absolute;" hidden>
    </div>

    <div class="col-md-12" style="padding-top: 40%" id="change_password">
        <div style="margin-bottom: 25px;">
            <h5><b>Sign in using an account issued by an organization</b></h5>
        </div>
        <form action="#" id="submit_form">
            <div style="margin-bottom: 5px;">
                <input type="text" class="form-control" id="username"
                       placeholder="User name" required/>
            </div>
            <div style="margin-bottom: 25px;">
                <input type="password" class="form-control" id="previous_password"
                       placeholder="Password" required/>
            </div>

            <div style="margin-bottom: 5px;">
                <input type="password" class="form-control" id="proposed_password"
                       placeholder="New Password" required/>
            </div>
            <div style="margin-bottom: 25px;">
                <input type="password" class="form-control" id="confirm_password"
                       placeholder="Confirm Password" required>
            </div>
            <button type="submit" class="btn btn-info" style="float: right">Confirm</button>
        </form>
    </div>
    <div class="col-md-12" id="usage" style="padding-top: 15%" hidden>
        #include("readme.html")
    </div>
    <footer style="position: fixed; bottom: 0;padding-left: 15px;">
        <h6>
            Copyright &#169; 2017 <a href="mailto:boyarsky.vitaliy@live.com">Boyarsky Vitaliy</a>. All rights reserved.
        </h6>
    </footer>
</div>
<script>

    function showResponseMessage(result) {
        var alert = $("#alert");
        alert.show("slow").delay(3000).hide("slow");

        if (result.acknowledged === true) {
            alert.attr("class", "alert alert-success");
        } else {
            alert.attr("class", "alert alert-danger")
        }

        alert.text(result.message)
    }

    $(document).ready(function () {
        $('#submit_form').on('submit', function (e) {
            e.preventDefault();

            $.ajax({
                url: "/v1/account",
                method: "POST",
                data: {
                    username: $('#username').val(),
                    previous_password: $('#previous_password').val(),
                    proposed_password: $('#proposed_password').val()
                },
                success: function (result) {
                    showResponseMessage(result);

                    if (result.acknowledged === true) {
                        $("#change_password").hide();
                        $("#usage").show();
                    }
                }
            });
        });

        var password = document.getElementById("proposed_password"),
            confirm_password = document.getElementById("confirm_password");

        function validatePassword() {
            if (password.value !== confirm_password.value) {
                confirm_password.setCustomValidity("Passwords Don't Match");
            } else {
                confirm_password.setCustomValidity('');
            }
        }

        password.onchange = validatePassword;
        confirm_password.onkeyup = validatePassword;
    });
</script>
</body>
</html>